<!DOCTYPE html>
<meta charset="utf-8">
<title>The Parable of The Hackasaurus</title>
<link rel="stylesheet" href="hints.css" class="hints">
<script src="jquery.min.js"></script>
<script>
function updateBugsLeftText(n) {
  var help = $(".help");
  help.find(".remaining").text(n);
  help.find(".singular").hide();
  help.find(".plural").hide();
  help.find(".not-done").hide();
  help.find(".done").hide();
  if (n == 0) {
    help.find(".done").show();
  } else {
    help.find(".not-done").show();
    if (n == 1) {
      help.find(".singular").show();
    } else {
      help.find(".plural").show();
    }
  }
}

function absoluteURL(url) {
  var a = $('<a></a>').attr('href', url);
  return a[0].href;
}

var HintFilters = {
  matches: function(selector) {
    return function(ui, target) {
      var query = $(selector);
      return target && $(target).is(selector);
    };
  },
  isOnCssProperty: function(name) {
    return function(ui, target) {
      var rowHover = $("div.webxray-row:hover");
      if (rowHover.length) {
        var row = rowHover[0];
        var widget = ui.jQuery(row).data("propertyWidget");
        if (widget.name == name && !widget.isBeingEdited())
          return true;
      }
      return false;
    };
  },
  isStyleOverlayLocked: function(isLocked) {
    return function(ui, target) {
      return (ui.styleInfoOverlay.isLocked() == isLocked);
    };
  },
  isStyleOverlayVisible: function(isVisible) {
    return function(ui, target) {
      return (ui.styleInfoOverlay.isVisible() == isVisible);
    };
  }
};

function HintManager(ui) {
  var hints = [];
  var currentTarget = null;
  
  var self = {
    plant: function(options) {
      var content = $(options.content).clone();
      $(document.body).append(content);
      content.hide();
      hints.push({
        content: content,
        when: options.when
      });
    }
  };
  
  function showOrHideHint() {
    hints.forEach(function(hint) {
      for (var i = 0; i < hint.when.length; i++) {
        if (!hint.when[i](ui, currentTarget)) {
          hint.content.hide();
          return;
        }
      };
      hint.content.fadeIn();
    });
  }
  
  function genericChange() {
    currentTarget = ui.focusedOverlay.getPrimaryElement();
    showOrHideHint();
  }
  
  function domEventChange() {
    showOrHideHint();
  }
  
  ui.focusedOverlay.on('change', genericChange);
  ui.styleInfoOverlay.on('show', genericChange);
  ui.styleInfoOverlay.on('hide', genericChange);
  ui.styleInfoOverlay.on('lock', function(info) {
    currentTarget = info.element;
    showOrHideHint();
  });
  $(".webxray-row").live({
    mouseover: showOrHideHint,
    mouseout: showOrHideHint
  });

  return self;
}

$(window).ready(function() {
  var bugs = [
    {
      isFixed: function isFloatOnCorrectSide() {
        return $(".drop-cap").css("float") == "left";
      },
      achievement: $("#style-hacker.achievement")
    },
    {
      isFixed: function isCurtainRemoved() {
        return $(".curtain").length == 0;
      },
      achievement: $("#deleter.achievement")
    },
    {
      isFixed: function isTypoFixed() {
        var text = $("p.needs-fixing").text();
        return text.indexOf("weeb") == -1;
      },
      achievement: $("#typo-fixer.achievement")
    },
    {
      isFixed: function isBrokenImageFixed() {
        return $("img#supergirl").attr("src") == "images/supergirl.png";
      },
      achievement: $("#url-hacker.achievement")
    }
  ];

  function updateBugsLeft() {
    var bugsLeft = 0;
    bugs.forEach(function(bug) {
      if (!bug.isFixed())
        bugsLeft++;
      else {
        if (!bug.hasBeenFixedBefore) {
          bug.hasBeenFixedBefore = true;
          if (bug.achievement)
            bug.achievement.delay(500).slideDown().delay(2500).slideUp();
        }
      }
    });
    updateBugsLeftText(bugsLeft);
  }
  
  updateBugsLeft();

  window.webxrayWhenGogglesLoad = function(ui) {
    var hints = HintManager(ui);

    hints.plant({
      content: ".deletion.hint",
      when: [HintFilters.matches(".curtain")]
    });

    hints.plant({
      content: ".remix.hint",
      when: [HintFilters.matches("p.needs-fixing")]
    });

    hints.plant({
      content: ".remix.hint",
      when: [HintFilters.matches("img#supergirl")]
    });
    
    hints.plant({
      content: ".float.hint",
      when: [
        HintFilters.matches("div.drop-cap"),
        HintFilters.isOnCssProperty("float")
      ]
    });
    
    hints.plant({
      content: ".pin.hint",
      when: [
        HintFilters.matches("div.drop-cap"),
        HintFilters.isStyleOverlayVisible(true),
        HintFilters.isStyleOverlayLocked(false)
      ]
    });

    hints.plant({
      content: ".style.hint",
      when: [
        HintFilters.matches("div.drop-cap"),
        HintFilters.isStyleOverlayVisible(false)
      ]
    });
    
    ui.commandManager.on('state-change', updateBugsLeft);
    ui.mixMaster.setDialogPageMods({
      stylesheets: [$("link.hints")[0].href],
      scripts: [absoluteURL('remix-dialog-pagemod.js')]
    });
    ui.styleInfoOverlay.setPropertyNames([
      "float",
      "font-family",
      "font-size",
      "color",
      "background-color"
    ]);
    ui.focusedOverlay.set($("#bookmarklet")[0]);
  };
});
</script>
<style>
html, body {
  font-family: Baskerville, Georgia, serif;
  width: 640px;
  margin: 0 auto;
  padding-top: 1em;
}

a#bookmarklet {
  padding-left: 32px;
  padding-top: 6px;
  padding-bottom: 6px;
  padding-right: 6px;
  color: black;
  border: 1px dotted gray;
  text-decoration: none;
  background-image: url(images/icon-goggles-tiny.png);
  background-repeat: no-repeat;
  background-position: 5px 4px;
}

a#bookmarklet:hover {
  background-color: #f0f0f0;
}

h1 {
  font-weight: normal;
  text-align: center;
}

div.drop-cap {
  font-size: 48px;
  margin-top: -6px;
  float: right;
}

div.help {
  position: fixed;
  top: 0px;
  left: 0px;
  z-index: 500;
  background: gray;
  color: white;
  width: 100%;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  text-align: center;
}

div.help a {
  color: inherit;
}

img#hackasaur {
  width: 400px;
  height: 300px;
}

img#supergirl {
  width: 300px;
  height: 330px;
}

.image-holder {
  text-align: center;
}

.curtain {
  position: absolute;
  width: 640px;
  height: 250px;
  background-color: white;
}

.remaining {
  font-weight: bold;
}

.achievement {
  display: none;
  position: fixed;
  left: 0px;
  bottom: 0px;
  font-family: "Helvetica Neue", Helvetica;
  font-weight: bold;
  padding: 10px;
  text-transform: uppercase;
  background: rgba(0, 0, 0, 0.9);
  z-index: 5000;
  pointer-events: none;
}

.achievement h3 {
  color: #e0e0e0;
  margin: 0;
  padding: 0;
  font-size: 10pt;
}

.achievement p {
  color: #B2E725;
  margin: 0;
  padding: 0;
  font-size: 24pt;
}
</style>
<div class="help">
  <span class="not-done">Can you fix this page? There <span class="singular">is</span><span class="plural">are</span> <span class="remaining"></span> thing<span class="plural">s</span> wrong with it.</span>
  <span class="done">Yay, you fixed the page! Now visit <a href="http://hackasaurus.org">hackasaurus.org</a> to learn how to use the goggles <em>anywhere</em> on the web.</span>
</div>

<div id="url-hacker" class="achievement">
  <h3>Achievement Unlocked</h3>
  <p>URL Hacker</p>
</div>

<div id="deleter" class="achievement">
  <h3>Achievement Unlocked</h3>
  <p>Deleter</p>
</div>

<div id="style-hacker" class="achievement">
  <h3>Achievement Unlocked</h3>
  <p>Style Hacker</p>
</div>

<div id="typo-fixer" class="achievement">
  <h3>Achievement Unlocked</h3>
  <p>Copy Editor</p>
</div>

<div class="remix-dialog-hints">
  <div class="attr hint">Click on an attribute value to edit it.</div>
  <div class="txt hint">Click on a text node to edit it.</div>
</div>

<div class="deletion hint">Tap <kbd>del</kbd> to remove an element.</div>

<div class="remix hint">Tap <kbd>R</kbd> to change the source code of an element.</div>

<div class="style hint">Press and hold <kbd>C</kbd> to view the style of an element.</div>

<div class="float hint">Click to edit a style property.</div>

<div class="pin hint">While holding <kbd>C</kbd>, tap the space bar to make changes to an element's style.</div>

<h1>The Parable of The Hackasaurus</h1>

<div class="drop-cap">O</div><p>nce upon a time there lived a clever girl named Sue who liked to make things. She knit hats and built robots to wear them. But she didn't know anything about how the Web worked; it was as opaque as a television screen to her.</p>

<p>One day a giant dinosaur appeared as she was exploring the web.</p>

<div class="image-holder"><div class="curtain"></div><img id="hackasaur" src="images/hackasaur.jpg" alt="Picture of Hackasaur" draggable="false"></div>

<p>“I’m going to show you how to hack the web!”, the dinosaur told Sue.</p>

<p>“Hack?” Sue asked. “Isn’t that evil?”</p>

<p>“No!” said the dinosaur. “Hacking can be used for good or ill. It is about tinkering with things to change how they work. Good hackers improve them and make them work better, but bad hackers make them worse.”</p>

<p>“Wow!” said Sue. “I want to be a good hacker.”</p>

<p>“Ok, then, try on these <a id="bookmarklet" href="javascript:(function(){var%20script=document.createElement('script');script.src='https://secure.toolness.com/webxray/webxray.js';script.className='webxray';document.head.appendChild(script);})();">Web X-Ray Goggles</a> and we'll get started!”</p>

<p class="needs-fixing">Sue wore the goggles the dinosaur gave her, and suddenly she could see and change how everything on the weeb was put together.</p>

<div class="image-holder"><img id="supergirl" src="imagees/supergirl.png" alt="Picture of Sue wearing goggles"></div>
